<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
	<script src="https://d3js.org/d3.v4.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
	<!--<script src="https://d3js.org/d3-geo-projection.v4.min.js"></script>-->

<style>

    body {
        font-family: Arial;
        font-size: 8px;
    }

	.route {
		fill: none;
		stroke: #333;
		opacity: 0.1;
	}

	.land { fill:#a8ddb5; }
	
	svg { background: #43a2ca; }

	.source-port {
		fill: white; 
		stroke: darkgreen; 
		stroke-width: 2px;
	}
</style>

	
</head>
<body>
	<div id="map"> </div>
	<script>
	
var width = 2000; var height = 1000;

var projection = d3.geoMercator()
// 	.scale(302)
// 	.rotate([-210,-10])
// 	.translate([width/2,height/2])
// 	.precision(0.1);

var path = d3.geoPath().projection(projection);

var svg = d3.select("#map").append("svg")
	.attr("width", width)
	.attr("height", height);
	
// Create a few groups to layer elements correctly
var g1 = svg.append("g");  
var g2 = svg.append("g"); 

d3.json("data/world.json",function(error,world) {
	g1.insert("path")
		.datum(topojson.feature(world, world.objects.land))
		.attr("class", "land")
		.attr("d", path);
		
// 	g2.append("circle")
// 		.attr("cx", function() { return projection(ports["Puget Sound"].loc)[0];})
// 		.attr("cy", function() { return projection(ports["Puget Sound"].loc)[1];})
// 		.attr("r",20)
// 		.attr("class","source-port");
	
// 	g2.append("text")
// 		.attr("x", function() { return projection(ports["Puget Sound"].loc)[0] + 5;})
// 		.attr("y", function() { return projection(ports["Puget Sound"].loc)[1] + 0;})
// 		.text("Puget Sound");
		
	drawTrade();
	});
	
// Draw a set of routes 
function drawTrade() {
	d3.csv("data/dadosCopa.csv", function (error, routes) {
		var maxVolume = d3.max(routes, function(d) { return d.jogos; });
		
		console.log(routes);
		
		routePath = g1.selectAll(".route")
			.data(routes)
			.enter()
			.append("path")
			.attr("class","route")
// 			.style("stroke-width", function(d) { 
// 				return 0.01 * d.jogos;
// 			})
			.style("stroke-width", 1)
			.attr('d', function(d) {
				return path ({ 
				type:"LineString",
				coordinates: [ ports[d.pais].loc,ports[d.paisclube].loc ]
				});
			})

// 		portMarkers = g1.selectAll(".ports")
// 			.data(routes)
// 			.enter()
// 			.append("circle")
// 			.attr("class","ports")
// 			.attr("cx", function(d) { return projection(ports[d.destination].loc)[0] } )
// 			.attr("cy", function(d) { return projection(ports[d.destination].loc)[1] } )
// 			.attr("r", function(d) { return d.vol * 25 })
// 			.style("fill","white")
// 			.style("stroke-width",2)
// 			.style("stroke","red");
		
// 		portLabels = g2.selectAll(".port-labels")
// 			.data(routes)
// 			.enter()
// 			.append("text")
// 			.attr("x", function(d) { return projection(ports[d.destination].loc)[0] + ports[d.destination].off[0] } )
// 			.attr("y", function(d) { return projection(ports[d.destination].loc)[1] - ports[d.destination].off[1] } )
// 			.text(function(d) { return d.destination })
// 			.attr("class","port-label");
		});
	}

	// Ports reference and text offset for labels.	
var ports = {
	"Africa do Sul":{loc:[-30.559482,22.937506]},
    "Alemanha":{loc:[51.165691,10.451526]},
    "Arabia Saudita":{loc:[23.885942,45.079162]},
    "Argentina":{loc:[-38.416097,-63.616672]},
    "Australia":{loc:[-25.274398,133.775136]},
    "Austrália":{loc:[-25.274398,133.775136]},
    "Austria":{loc:[47.516231,14.550072]},
    "Belgica":{loc:[50.503887,4.469936]},
    "Bélgica":{loc:[50.503887,4.469936]},
    "Brasil":{loc:[-14.235004,-51.92528]},
    "Bulgaria":{loc:[42.733883,25.48583]},
    "Canada":{loc:[56.130366,-106.346771]},
    "Chile":{loc:[-35.675147,-71.542969]},
    "China":{loc:[35.86166,104.195397]},
    "Colombia":{loc:[4.570868,-74.297333]},
    "Colômbia":{loc:[4.570868,-74.297333]},
    "Coreia":{loc:[35.907757,127.766922]},
    "Coreia do Sul":{loc:[35.907757,127.766922]},
    "Costa Rica":{loc:[9.748917,-83.753428]},
    "Croácia":{loc:[45.1,15.2]},
    "Dinamarca":{loc:[56.26392,9.501785]},
    "Egito":{loc:[26.820553,30.802498]},
    "Emirados Arabes":{loc:[23.424076,53.847818]},
    "Escocia":{loc:[56.071739,-3.452151]},
    "Espanha":{loc:[40.463667,-3.74922]},
    "EUA":{loc:[37.09024,-95.712891]},
    "Finlandia":{loc:[61.92411,25.748151]},
    "FRança":{loc:[46.227638,2.213749]},
    "França":{loc:[46.227638,2.213749]},
    "Françå":{loc:[46.227638,2.213749]},
    "Grecia":{loc:[39.074208,21.824312]},
    "Guatemala":{loc:[15.783471,-90.230759]},
    "Guiana":{loc:[4.860416,-58.93018]},
    "Holanda":{loc:[52.132633,5.291266]},
    "Inglaterra":{loc:[55.378051,-3.435973]},
    "Irã":{loc:[32.427908,53.688046]},
    "Iran":{loc:[32.427908,53.688046]},
    "Islandia":{loc:[64.963051,-19.020835]},
    "Islândia":{loc:[64.963051,-19.020835]},
    "Israel":{loc:[31.046051,34.851612]},
    "Italia":{loc:[41.87194,12.56738]},
    "Itália":{loc:[41.87194,12.56738]},
    "Japao":{loc:[36.204824,138.252924]},
    "Japão":{loc:[36.204824,138.252924]},
    "Marrocos":{loc:[31.791702,-7.09262]},
    "Mexico":{loc:[23.634501,-102.552784]},
    "México":{loc:[23.634501,-102.552784]},
    "Nápoles":{loc:[41.87194,12.56738]},
    "Nigeria":{loc:[9.081999,8.675277]},
    "Nigéria":{loc:[9.081999,8.675277]},
    "Noruega":{loc:[60.472024,8.468946]},
    "Pais de Gales":{loc:[53.34061,-1.28162]},
    "País de Gales":{loc:[53.34061,-1.28162]},
    "Panama":{loc:[8.537981,-80.782127]},
    "Panamá":{loc:[8.537981,-80.782127]},
    "Paraguai":{loc:[-23.442503,-58.443832]},
    "Peru":{loc:[-9.189967,-75.015152]},
    "Polonia":{loc:[51.919438,19.145136]},
    "Polônia":{loc:[51.919438,19.145136]},
    "Portugal":{loc:[39.399872,-8.224454]},
    "Qatar":{loc:[25.354826,51.183884]},
    "Romenia":{loc:[45.943161,24.96676]},
    "Russia":{loc:[61.52401,105.318756]},
    "Rússia":{loc:[61.52401,105.318756]},
    "Senegal":{loc:[14.497401,-14.452362]},
    "Servia":{loc:[44.016521,21.005859]},
    "Sérvia":{loc:[44.016521,21.005859]},
    "Suecia":{loc:[60.128161,18.643501]},
    "Suécia":{loc:[60.128161,18.643501]},
    "Suiça":{loc:[46.818188,8.227512]},
    "Suíça":{loc:[46.818188,8.227512]},
    "Tunisia":{loc:[33.886917,9.537499]},
    "Tunísia":{loc:[33.886917,9.537499]},
    "Turquia":{loc:[38.963745,35.243322]},
    "Ucrania":{loc:[48.379433,31.16558]},
    "Uruguai":{loc:[-32.522779,-55.765835]},
};
	

	</script>

</body>
</html>